var e=(e,t,a)=>new Promise((s,l)=>{var o=e=>{try{u(a.next(e))}catch(t){l(t)}},r=e=>{try{u(a.throw(e))}catch(t){l(t)}},u=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);u((a=a.apply(e,t)).next())});import{C as t,r as a,y as s,E as l}from"./vendor-DFhOdd_z.js";import{e as o}from"./api-DJYTD1GY.js";const r=a(null),u=a(!1),n=s(()=>!!r.value);function c(){let a=null;try{a=t()}catch(s){}return{user:l(r),isAuthenticated:n,isLoading:l(u),login:t=>e(null,null,function*(){var e,a;try{u.value=!0;const e=yield o.login(t);return e.data.success?(r.value=e.data.user,localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),window.$notify&&window.$notify.success("Welcome back!",`Hello ${e.data.user.first_name||e.data.user.name}`),{success:!0,user:e.data.user}):{success:!1,message:"Login failed"}}catch(s){return{success:!1,message:(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Login failed. Please try again."}}finally{u.value=!1}}),register:t=>e(null,null,function*(){var e,a;try{u.value=!0;const e=yield o.register(t);return e.data.success?(r.value=e.data.user,localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),window.$notify&&window.$notify.success("Welcome to CarWise!",`Account created for ${e.data.user.first_name||e.data.user.name}`),{success:!0,user:e.data.user}):{success:!1,message:"Registration failed"}}catch(s){return{success:!1,message:(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Registration failed. Please try again."}}finally{u.value=!1}}),logout:()=>e(null,null,function*(){try{yield o.logout()}catch(e){}finally{r.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),window.$notify&&window.$notify.info("Logged Out","You have been successfully logged out"),a&&a.push("/login")}}),checkAuth:()=>e(null,null,function*(){const e=localStorage.getItem("token"),t=localStorage.getItem("user");if(e&&t)try{r.value=JSON.parse(t);const e=yield o.getUser();return e.data.success&&(r.value=e.data.user,localStorage.setItem("user",JSON.stringify(e.data.user))),!0}catch(a){return r.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),!1}return!1}),updateUser:e=>{r.value=e,localStorage.setItem("user",JSON.stringify(e))},getUser:()=>r.value,getIsAuthenticated:()=>n.value,getIsLoading:()=>u.value}}(()=>{const e=localStorage.getItem("user");if(e)try{r.value=JSON.parse(e)}catch(t){localStorage.removeItem("user"),localStorage.removeItem("token")}})();export{c as u};
